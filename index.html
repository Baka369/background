<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Webcam Access with High Quality</title>
    <style>
        video {
            width: 100%;
            max-width: 1920px;
            margin: 0 auto;
            display: block;
        }
    </style>
</head>
<body>
    <video id="webcamVideo" autoplay playsinline></video>

    <script>
        const webcamVideo = document.getElementById("webcamVideo");
        const constraints = {
            video: {
                width: { ideal: 1920 },
                height: { ideal: 1080 },
                aspectRatio: { ideal: 1.7777777778 },
                facingMode: "environment",
                frameRate: { ideal: 60, min: 30 },
                resizeMode: 'none',
                brightness: { ideal: 100 },
                contrast: { ideal: 95 },
                saturation: { ideal: 100 },
                sharpness: { ideal: 100 },
                focusMode: "continuous",
                whiteBalanceMode: "continuous",
                exposureMode: "continuous",
                exposureCompensation: { ideal: 0 },
                zoom: { ideal: 1.0 },
                colorTemperature: { ideal: 5500 },
                iso: { ideal: 100 },
                noiseReduction: { ideal: true },
                backgroundBlur: { ideal: 0 },
                powerLineFrequency: { ideal: 50 }
            },
            audio: false
        };

        async function initializeCamera() {
            try {
                // Request camera access with advanced constraints
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // Get video track for additional settings
                const videoTrack = stream.getVideoTracks()[0];
                
                // Apply advanced settings if supported
                const capabilities = videoTrack.getCapabilities();
                const settings = videoTrack.getSettings();
                
                // Enable torch if available
                if (capabilities.torch) {
                    await videoTrack.applyConstraints({ advanced: [{ torch: true }] });
                }

                // Set video source
                webcamVideo.srcObject = stream;
                
                // Enable advanced image capture if supported
                if ('imageCapture' in window) {
                    const imageCapture = new ImageCapture(videoTrack);
                    // Additional image capture settings can be added here
                }

                console.log('Camera initialized with settings:', settings);
                
                // Apply additional advanced settings if available
                if (videoTrack.getSettings) {
                    const currentSettings = videoTrack.getSettings();
                    console.log('Current camera settings:', currentSettings);
                }

            } catch (error) {
                console.error('Error accessing camera:', error);
                // Handle specific error types
                if (error.name === 'NotAllowedError') {
                    alert('Camera access denied. Please enable camera permissions.');
                } else if (error.name === 'NotFoundError') {
                    alert('No camera found on this device.');
                } else {
                    alert('Error accessing camera: ' + error.message);
                }
            }
        }

        // Initialize camera when page loads
        window.addEventListener('load', initializeCamera);

        // Handle visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                initializeCamera();
            }
        });

        // Optional: Add event listener for orientation changes
        window.addEventListener('orientationchange', () => {
            setTimeout(initializeCamera, 200); // Reinitialize camera after orientation change
        });

        // Optional: Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                initializeCamera();
            }, 200);
        });

        // Optional: Add function to take high-quality snapshot
        async function takeHighQualitySnapshot() {
            try {
                const videoTrack = webcamVideo.srcObject.getVideoTracks()[0];
                const imageCapture = new ImageCapture(videoTrack);
                const photoSettings = {
                    imageHeight: 1920,
                    imageWidth: 1080,
                    redEyeReduction: true,
                    fillLightMode: "auto"
                };
                const photo = await imageCapture.takePhoto(photoSettings);
                return photo;
            } catch (error) {
                console.error('Error taking photo:', error);
                return null;
            }
        }

        // Optional: Error recovery function
        function handleCameraError() {
            setTimeout(() => {
                initializeCamera().catch(error => {
                    console.error('Camera recovery failed:', error);
                });
            }, 1000);
        }
    </script>
</body>
</html>
